# ๐ Distributed Task Queue

![Go](https://img.shields.io/badge/Go-1.23-00ADD8?style=flat&logo=go)
![Redis](https://img.shields.io/badge/Redis-7.0-DC382D?style=flat&logo=redis)
![Docker](https://img.shields.io/badge/Docker-Compose-2496ED?style=flat&logo=docker)
![License](https://img.shields.io/badge/License-MIT-green)

ะัะธะฝััะพะฝะฝะฐั ัะฐัะฟัะตะดะตะปัะฝะฝะฐั ะพัะตัะตะดั ะทะฐะดะฐั ะฝะฐ **Go**, ะธัะฟะพะปัะทัััะฐั **Redis** ะบะฐะบ ะฑัะพะบะตั ัะพะพะฑัะตะฝะธะน.

ะะตะฐะปะธะทะพะฒะฐะฝั ะฟะฐััะตัะฝั **Worker Pool**, **Exponential Backoff Retry**, **Graceful Shutdown** ะธ **Structured Logging** (`slog`).

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะััะธัะตะบัััะฐ](#-ะฐััะธัะตะบัััะฐ)
- [ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ](#-ะบะปััะตะฒัะต-ะพัะพะฑะตะฝะฝะพััะธ)
- [ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ](#-ัะตัะฝะพะปะพะณะธัะตัะบะธะน-ััะตะบ)
- [ะัััััะน ััะฐัั](#-ะฑัััััะน-ััะฐัั)
- [API](#-api)
- [ะขะธะฟั ะทะฐะดะฐั](#-ัะธะฟั-ะทะฐะดะฐั)
- [Retry ะปะพะณะธะบะฐ](#-retry-ะปะพะณะธะบะฐ)
- [ะกัััะบัััะฐ ะฟัะพะตะบัะฐ](#-ััััะบัััะฐ-ะฟัะพะตะบัะฐ)
- [ะขะตััั](#-ัะตััั)
- [ะะพะฝัะธะณััะฐัะธั](#%EF%B8%8F-ะบะพะฝัะธะณััะฐัะธั)

---

## ๐ ะััะธัะตะบัััะฐ

ะกะธััะตะผะฐ ัะพััะพะธั ะธะท ัััั ะบะพะผะฟะพะฝะตะฝัะพะฒ:

1. **API Server** โ ะฟัะธะฝะธะผะฐะตั HTTP-ะทะฐะฟัะพัั, ะฒะฐะปะธะดะธััะตั ะธ ััะฐะฒะธั ะทะฐะดะฐัะธ ะฒ Redis
2. **Redis** โ ะฟะตััะธััะตะฝัะฝะพะต ััะฐะฝะธะปะธัะต ะทะฐะดะฐั (ะพัะตัะตะดั + ัะตะทัะปััะฐัั)
3. **Worker Pool** โ ะฝะฐะฑะพั ะณะพัััะธะฝ, ะบะพัะพััะต ะฒััะธััะฒะฐัั ะทะฐะดะฐัะธ, ะฒัะฟะพะปะฝััั ะธ ะพะฑะฝะพะฒะปััั ััะฐััั

```
โโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโ
โ              โ       โ          Redis            โ       โ  Worker Pool โ
โ  Client      โ       โ                          โ       โ              โ
โ  (curl/app)  โโโโโโโโถโ  taskqueue:pending [list] โโโโโโโโถโ  Worker 0    โ
โ              โ  HTTP โ  taskqueue:task:id {json} โ  Pop  โ  Worker 1    โ
โ  POST /tasks โ       โ                          โโโโโโโโโ  Worker 2    โ
โ  GET /tasks  โ       โ                          โUpdate โ              โ
โโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโ
```

---

## โจ ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ

### Reliability (ะะฐะดัะถะฝะพััั)
- **Retry Policy** โ ะฟัะธ ะพัะธะฑะบะต ะทะฐะดะฐัะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะทะฐะฟััะบะฐะตััั
- **Exponential Backoff** โ ะธะฝัะตัะฒะฐะป ะผะตะถะดั ะฟะพะฟััะบะฐะผะธ ัะฐัััั: `1s โ 2s โ 4s`
- **Dead Letter Logic** โ ะฟะพัะปะต `MaxRetry` (ะฟะพ ัะผะพะปัะฐะฝะธั 3) ะทะฐะดะฐัะฐ ะฟะพะผะตัะฐะตััั `failed`

### Concurrency (ะะพะฝะบััะตะฝัะฝะพััั)
- ะะพะฝัะธะณััะธััะตะผัะน **Worker Pool** ะดะปั ะฟะฐัะฐะปะปะตะปัะฝะพะน ะพะฑัะฐะฑะพัะบะธ ะทะฐะดะฐั
- ะะพัะพะบะพะฑะตะทะพะฟะฐัะฝะฐั ะฐััะธัะตะบัััะฐ (`sync.RWMutex`, `sync.WaitGroup`)

### Observability (ะะฐะฑะปัะดะฐะตะผะพััั)
- **Structured Logging** ัะตัะตะท `log/slog` (Go 1.21+) ะฒ JSON-ัะพัะผะฐัะต
- ะะฐะถะดัะน ะปะพะณ ัะพะดะตัะถะธั `task_id` ะธ `worker_id` ะดะปั ัะบะฒะพะทะฝะพะน ััะฐััะธัะพะฒะบะธ

### DevOps Ready
- ะะพะปะฝะฐั ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั ัะตัะตะท **Docker Compose**
- **Graceful Shutdown** โ ะฟัะธ `SIGTERM`/`SIGINT` ัะตัะฒะตั ะฟะตัะตััะฐัั ะฟัะธะฝะธะผะฐัั ะทะฐะฟัะพัั, ะฒะพัะบะตัั ะดะพะดะตะปัะฒะฐัั ัะตะบััะธะต ะทะฐะดะฐัะธ

---

## ๐ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

| ะะฐัะตะณะพัะธั | ะขะตัะฝะพะปะพะณะธั |
|-----------|-----------|
| ะฏะทัะบ | Go 1.22+ |
| ะัะพะบะตั / ะะ | Redis 7 (go-redis/v9) |
| HTTP ัะพััะตั | chi v5 |
| ะะพะฝัะธะณััะฐัะธั | ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (12-Factor App) |
| ะขะตััั | `testing` + `testify` + `miniredis` |
| ะะพะฝัะตะนะฝะตัะธะทะฐัะธั | Docker, Docker Compose |
| ะะพะณะธัะพะฒะฐะฝะธะต | `log/slog` (structured JSON) |

---

## โก ะัััััะน ััะฐัั

### Docker Compose (ัะตะบะพะผะตะฝะดัะตััั)

```bash
git clone https://github.com/podushkina/taskqueue.git
cd taskqueue
docker-compose up --build
```

ะกะตัะฒะตั ะทะฐะฟัััะธััั ะฝะฐ ะฟะพััั `:8080`.

### ะะพะบะฐะปัะฝะพ

```bash
# ะะฐะฟัััะธัั Redis
docker run -d -p 6379:6379 --name redis redis:7-alpine

# ะะฐะฟัััะธัั ะฟัะธะปะพะถะตะฝะธะต
cp .env.example .env
go run cmd/server/main.go
```

---

## ๐ API

### ะกะพะทะดะฐัั ะทะฐะดะฐัั

**`POST /tasks`**

```bash
curl -X POST http://localhost:8080/tasks \
  -H "Content-Type: application/json" \
  -d '{"type": "echo", "payload": "Hello World"}'
```

ะัะฒะตั (`201 Created`):
```json
{
  "id": "5335d502-a2c7-4abd-9496-c64692b43869",
  "type": "echo",
  "payload": "Hello World",
  "status": "pending",
  "retries": 0,
  "max_retry": 3,
  "created_at": "2026-02-01T10:53:32Z",
  "updated_at": "2026-02-01T10:53:32Z"
}
```

### ะะพะปััะธัั ััะฐััั ะทะฐะดะฐัะธ

**`GET /tasks/{id}`**

```bash
curl http://localhost:8080/tasks/5335d502-a2c7-4abd-9496-c64692b43869
```

ะัะฒะตั (`200 OK`):
```json
{
  "id": "5335d502-a2c7-4abd-9496-c64692b43869",
  "type": "echo",
  "status": "completed",
  "result": "echo: Hello World",
  "retries": 0,
  "max_retry": 3,
  "created_at": "2026-02-01T10:53:32Z",
  "updated_at": "2026-02-01T10:53:33Z"
}
```

### ะกะฟะธัะพะบ ะฒัะตั ะทะฐะดะฐั

**`GET /tasks`**

```bash
curl http://localhost:8080/tasks
```

### ะฃะดะฐะปะธัั ะทะฐะดะฐัั

**`DELETE /tasks/{id}`**

```bash
curl -X DELETE http://localhost:8080/tasks/5335d502-a2c7-4abd-9496-c64692b43869
```

ะัะฒะตั: `204 No Content`

### Health Check

**`GET /health`**

```bash
curl http://localhost:8080/health
# {"status": "ok"}
```

---

## ๐ฏ ะขะธะฟั ะทะฐะดะฐั

| ะขะธะฟ | ะะฟะธัะฐะฝะธะต | ะัะธะผะตั Payload | ะัะธะผะตั Result |
|-----|----------|---------------|--------------|
| `echo` | ะะพะทะฒัะฐัะฐะตั payload | `"Hello"` | `"echo: Hello"` |
| `reverse` | ะะตัะตะฒะพัะฐัะธะฒะฐะตั ัััะพะบั | `"Hello"` | `"olleH"` |
| `sum` | ะกัะผะผะธััะตั JSON-ะผะฐััะธะฒ ัะธัะตะป | `"[1, 2, 5]"` | `"8.00"` |
| `slow` | ะะผะธัะฐัะธั ะดะพะปะณะพะน ะพะฟะตัะฐัะธะธ (5 ัะตะบ) | ะปัะฑะพะน | `"completed after 5 seconds"` |
| `flaky` | ะกะปััะฐะนะฝะพ ะฟะฐะดะฐะตั (ะดะตะผะพ retry) | ะปัะฑะพะน | `"flaky: ..."` ะธะปะธ ะพัะธะฑะบะฐ |

---

## ๐ Retry ะปะพะณะธะบะฐ

ะัะธ ะพัะธะฑะบะต ะพะฑัะฐะฑะพัะบะธ ะทะฐะดะฐัะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒะพะทะฒัะฐัะฐะตััั ะฒ ะพัะตัะตะดั ั ัะบัะฟะพะฝะตะฝัะธะฐะปัะฝัะผ backoff:

```
ะะพะฟััะบะฐ 1: ะพัะธะฑะบะฐ  โ  ะถะดัะผ 1s  โ  retry
ะะพะฟััะบะฐ 2: ะพัะธะฑะบะฐ  โ  ะถะดัะผ 2s  โ  retry
ะะพะฟััะบะฐ 3: ะพัะธะฑะบะฐ  โ  ะถะดัะผ 4s  โ  retry
ะะพะฟััะบะฐ 4: ะพัะธะฑะบะฐ  โ  ััะฐััั "failed" (max retries exceeded)
```

ะะธะทะฝะตะฝะฝัะน ัะธะบะป ะทะฐะดะฐัะธ:

```
                  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ                               โ
                  โผ                               โ
โโโโโโโโโโโ   โโโโโโโโโโโโโโ   โโโโโโโโโโโโโ     โ
โ pending โโโโถโ processing โโโโถโ completed โ     โ
โโโโโโโโโโโ   โโโโโโโโโโโโโโ   โโโโโโโโโโโโโ     โ
                  โ                               โ
                  โ error + retries < max         โ
                  โ                               โ
                  โโโโโโ backoff โโ retry โโโโโโโโโโ
                  โ
                  โ error + retries >= max
                  โผ
              โโโโโโโโโโโโ
              โ  failed  โ
              โโโโโโโโโโโโ
```

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
taskqueue/
โโโ cmd/
โ   โโโ server/
โ       โโโ main.go
โโโ internal/
โ   โโโ api/
โ   โ   โโโ handler.go
โ   โ   โโโ handler_test.go
โ   โ   โโโ router.go
โ   โโโ config/
โ   โ   โโโ config.go
โ   โโโ handlers/
โ   โ   โโโ handlers.go
โ   โโโ queue/
โ   โ   โโโ queue.go
โ   โ   โโโ queue_test.go
โ   โโโ task/
โ   โ   โโโ task.go
โ   โโโ worker/
โ       โโโ pool.go
โ       โโโ pool_test.go
โโโ docker-compose.yml
โโโ Dockerfile
โโโ .gitignore
โโโ go.mod
โโโ go.sum
```

---

## ๐งช ะขะตััั

```bash
# ะัะต ัะตััั
go test ./... -v

# ะก ะฟะพะบัััะธะตะผ
go test ./... -cover

# ะก ะฟัะพะฒะตัะบะพะน ะฝะฐ ะณะพะฝะบะธ ะดะฐะฝะฝัั
go test ./... -race
```

---

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

ะะฐัััะฐะธะฒะฐะตััั ัะตัะตะท ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (ะธะปะธ `docker-compose.yml`):

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั |
|-----------|----------|-----------------------|
| `SERVER_PORT` | ะะพัั API ัะตัะฒะตัะฐ | `8080` |
| `REDIS_ADDR` | ะะดัะตั Redis | `localhost:6379` |
| `REDIS_PASSWORD` | ะะฐัะพะปั Redis | _(ะฟัััะพ)_ |
| `REDIS_DB` | ะะพะผะตั ะฑะฐะทั Redis (0โ15) | `0` |
| `WORKER_COUNT` | ะะพะปะธัะตััะฒะพ ะฒะพัะบะตัะพะฒ | `3` |

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ัะฐัะฟัะพัััะฐะฝัะตััั ะฟะพะด ะปะธัะตะฝะทะธะตะน [MIT](LICENSE).